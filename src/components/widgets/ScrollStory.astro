---
import Image from '~/components/common/Image.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  id?: string;
  image?: {
    src: string | ImageMetadata;
    alt?: string;
  };
}

const { id, image } = Astro.props;
---

<section class="scroll-story relative not-prose min-h-screen" {...id ? { id } : {}}>
  <!-- Lenis + GSAP initialization -->
  <script>
    import Lenis from 'lenis';
    import { gsap } from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';

    gsap.registerPlugin(ScrollTrigger);

    function initScrollStory() {
      // Initialize Lenis smooth scrolling
      const lenis = new Lenis({
        duration: 1.2,
        easing: (t: number) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        orientation: 'vertical',
        smoothWheel: true,
      });

      // Connect Lenis to GSAP ScrollTrigger
      lenis.on('scroll', ScrollTrigger.update);

      gsap.ticker.add((time) => {
        lenis.raf(time * 1000);
      });

      gsap.ticker.lagSmoothing(0);

      // Animate story lines
      const storyLines = document.querySelectorAll('.story-line');
      storyLines.forEach((line, index) => {
        gsap.fromTo(
          line,
          {
            opacity: 0,
            y: 60,
          },
          {
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: 'power3.out',
            scrollTrigger: {
              trigger: line,
              start: 'top 85%',
              end: 'top 50%',
              toggleActions: 'play none none reverse',
            },
            delay: index * 0.05,
          }
        );
      });

      // Animate annotations
      const annotations = document.querySelectorAll('.annotation');
      annotations.forEach((annotation) => {
        gsap.fromTo(
          annotation,
          { opacity: 0, scale: 0.8 },
          {
            opacity: 1,
            scale: 1,
            duration: 0.5,
            ease: 'back.out(1.7)',
            scrollTrigger: {
              trigger: annotation,
              start: 'top 80%',
              toggleActions: 'play none none reverse',
            },
          }
        );
      });

      // Parallax effect for hero image
      const heroImage = document.querySelector('.hero-parallax');
      if (heroImage) {
        gsap.to(heroImage, {
          y: 150,
          ease: 'none',
          scrollTrigger: {
            trigger: heroImage,
            start: 'top bottom',
            end: 'bottom top',
            scrub: true,
          },
        });
      }

      // Animate scroll arrow
      const scrollArrow = document.querySelector('.scroll-arrow');
      if (scrollArrow) {
        gsap.to(scrollArrow, {
          y: 15,
          duration: 1.5,
          ease: 'power1.inOut',
          repeat: -1,
          yoyo: true,
        });
      }

      // Progress indicator
      const progressBar = document.querySelector('.scroll-progress');
      if (progressBar) {
        gsap.to(progressBar, {
          scaleX: 1,
          ease: 'none',
          scrollTrigger: {
            trigger: document.body,
            start: 'top top',
            end: 'bottom bottom',
            scrub: 0.3,
          },
        });
      }
    }

    // Initialize on page load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initScrollStory);
    } else {
      initScrollStory();
    }

    // Re-initialize after Astro view transitions
    document.addEventListener('astro:after-swap', initScrollStory);
  </script>

  <!-- Progress bar -->
  <div class="scroll-progress fixed top-0 left-0 right-0 h-1 bg-primary z-50 origin-left" style="transform: scaleX(0);">
  </div>

  <!-- Hero Section with Story -->
  <div class="relative max-w-6xl mx-auto px-6 sm:px-8 lg:px-12">
    <!-- Minimal header spacing -->
    <div class="pt-24 md:pt-32"></div>

    <!-- Main story content -->
    <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 items-start">
      <!-- Story text -->
      <div class="story-content space-y-1 lg:space-y-2">
        <!-- Opening hook -->
        <p class="story-line text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold leading-[1.1] tracking-tight">
          <span class="inline-flex items-baseline gap-2">
            <span class="wave-emoji text-5xl md:text-6xl" aria-hidden="true">→</span>
            Nicholas is a
          </span>
        </p>

        <p class="story-line text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold leading-[1.1] tracking-tight">
          roboticist &amp; AI
        </p>

        <p class="story-line text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold leading-[1.1] tracking-tight">
          entrepreneur
        </p>

        <p class="story-line text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold leading-[1.1] tracking-tight">
          from
          <span class="annotation-wrapper inline-flex items-baseline">
            <span class="annotation text-sm sm:text-base font-normal text-muted align-super ml-1">(Canada)</span>
          </span>
          Montréal,
        </p>

        <p class="story-line text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold leading-[1.1] tracking-tight">
          currently building
        </p>

        <p class="story-line text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold leading-[1.1] tracking-tight">
          <span class="text-primary font-black">Personal Intelligence</span>
        </p>

        <p
          class="story-line text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold leading-[1.1] tracking-tight inline-flex items-baseline flex-wrap gap-x-4"
        >
          as CTO
          <span class="annotation text-sm sm:text-base font-normal text-muted">@</span>
          <span class="font-black tracking-tighter">Onix.</span>
        </p>
      </div>

      <!-- Hero image with parallax -->
      <div class="hero-parallax relative lg:sticky lg:top-32 will-change-transform">
        {
          image && (
            <div class="relative overflow-hidden rounded-2xl shadow-2xl">
              {typeof image === 'string' ? (
                <Fragment set:html={image} />
              ) : (
                <Image
                  class="w-full h-auto object-cover"
                  widths={[400, 768, 1024]}
                  sizes="(max-width: 767px) 100vw, (max-width: 1023px) 50vw, 600px"
                  loading="eager"
                  width={600}
                  height={700}
                  {...image}
                />
              )}
            </div>
          )
        }
      </div>
    </div>

    <!-- Second part of story -->
    <div class="mt-16 md:mt-24 lg:mt-32 max-w-4xl">
      <p class="story-line text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold leading-[1.15] tracking-tight">
        Previously, he was
      </p>

      <p class="story-line text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold leading-[1.15] tracking-tight mt-2">
        CTO at <span class="font-black">1X</span>
        <span class="annotation text-sm sm:text-base font-normal text-muted ml-2">(humanoid robots)</span>
      </p>

      <p class="story-line text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold leading-[1.15] tracking-tight mt-2">
        &amp; <span class="font-black">AON3D</span>
        <span class="annotation text-sm sm:text-base font-normal text-muted ml-2">(YC W17)</span>
      </p>

      <p class="story-line text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold leading-[1.15] tracking-tight mt-2">
        where he built tech
      </p>

      <p class="story-line text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold leading-[1.15] tracking-tight mt-2">
        now on the <span class="text-primary font-black">ISS</span>
      </p>

      <p class="story-line text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold leading-[1.15] tracking-tight mt-2">
        &amp; the <span class="text-primary font-black">Moon.</span>
      </p>
    </div>

    <!-- Third part - credentials & community -->
    <div class="mt-16 md:mt-24 lg:mt-32 max-w-5xl">
      <p class="story-line text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold leading-[1.2] tracking-tight">
        With a <span class="font-black">Ph.D.</span> in robotics &amp; AI,
      </p>

      <p class="story-line text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold leading-[1.2] tracking-tight mt-2">
        he mentors startups at
      </p>

      <p
        class="story-line text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold leading-[1.2] tracking-tight mt-2 flex flex-wrap items-baseline gap-x-3"
      >
        <span class="font-black border-b-2 border-current">CDL</span>,
        <span class="font-black border-b-2 border-current">NEXT AI</span>,
        <span>&amp;</span>
        <span class="font-black border-b-2 border-current">Startupfest</span>.
      </p>

      <p class="story-line text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold leading-[1.2] tracking-tight mt-6">
        Co-founded
        <span class="font-black">AI Salon Montréal</span>
      </p>

      <p class="story-line text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold leading-[1.2] tracking-tight mt-2">
        &amp; serves as Board President
      </p>

      <p class="story-line text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold leading-[1.2] tracking-tight mt-2">
        at <span class="font-black">Garage&amp;Co</span>
        <span class="annotation text-sm sm:text-base font-normal text-muted ml-2">(hardtech accelerator)</span>
      </p>
    </div>

    <!-- Mission statement -->
    <div class="mt-16 md:mt-24 lg:mt-32 max-w-4xl">
      <p class="story-line text-2xl sm:text-3xl md:text-4xl font-medium leading-[1.3] text-muted">
        He believes in building AI that
      </p>

      <p class="story-line text-2xl sm:text-3xl md:text-4xl font-medium leading-[1.3] text-muted mt-2">
        <span class="text-default font-bold">amplifies human genius</span>
      </p>

      <p class="story-line text-2xl sm:text-3xl md:text-4xl font-medium leading-[1.3] text-muted mt-2">
        rather than replacing it—
      </p>

      <p class="story-line text-2xl sm:text-3xl md:text-4xl font-medium leading-[1.3] text-muted mt-2">
        <span class="text-default font-bold">privacy-first</span>,
        <span class="text-default font-bold">human-centered</span>,
      </p>

      <p class="story-line text-2xl sm:text-3xl md:text-4xl font-medium leading-[1.3] text-muted mt-2">
        &amp; <span class="text-default font-bold">open to all.</span>
      </p>
    </div>

    <!-- CTA Section -->
    <div class="mt-16 md:mt-24 lg:mt-32 pb-8">
      <a
        href="mailto:nicholas@nadeauinnovations.com"
        class="story-line inline-block border-2 border-current px-8 py-4 text-xl sm:text-2xl font-bold hover:bg-default hover:text-page transition-colors duration-300"
      >
        Get in touch
      </a>
    </div>

    <!-- Scroll indicator -->
    <div class="flex justify-center py-12">
      <div class="scroll-arrow text-4xl">↓</div>
    </div>
  </div>
</section>

<style>
  .scroll-story {
    @apply text-default;
  }

  .annotation-wrapper {
    position: relative;
  }

  .annotation {
    @apply opacity-70;
  }

  /* Smooth link underlines */
  .story-line a {
    @apply underline underline-offset-4 decoration-2 hover:decoration-primary transition-colors;
  }

  /* Wave animation for arrow */
  .wave-emoji {
    display: inline-block;
    animation: wave 2s ease-in-out infinite;
  }

  @keyframes wave {
    0%,
    100% {
      transform: translateX(0);
    }
    50% {
      transform: translateX(8px);
    }
  }
</style>
